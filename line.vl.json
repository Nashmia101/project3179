{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Average Rainfall Trend of Peninsular Malaysian States Across Years from 2014 to 2020",
  "width": 720,
  "height": 420,
  "padding": { "bottom": 56 },

  "params": [
    {
      "name": "StatePick",
      "value": "Pahang",
      "bind": {
        "input": "select",
        "name": "State: ",
        "options": [
          "Johor","Kedah","Kelantan","Melaka","NSembilan",
          "Pahang","Penang","Perak","Perlis",
          "Selangor","Selangor-Wilayah","Terengganu"
        ]
      }
    }
  ],

  "data": {
    "url": "https://raw.githubusercontent.com/Nashmia101/project3179/main/rainfall_state_year_avg.csv"
  },

  "transform": [
    { "filter": "datum.State == StatePick" },
    { "calculate": "toNumber(datum.Avg_Rainfall_mm)", "as": "rain_mm" },
    { "calculate": "toNumber(datum.Year)", "as": "year_num" }
  ],

  "layer": [
    {
      "mark": {
        "type": "line",
        "point": { "filled": true, "size": 64 },
        "strokeWidth": 2,
        "clip": true
      },
      "encoding": {
        "x": {
          "field": "year_num",
          "type": "quantitative",
          "title": "Year",
          "scale": { "domain": [2013.5, 2020.5] },
          "axis": { "tickMinStep": 1, "format": "d" }
        },
        "y": {
          "field": "rain_mm",
          "type": "quantitative",
          "title": "Average daily rainfall (mm)",
          "scale": { "domainMin": 0, "nice": true }
        },
        "color": { "value": "#5b21b6" },
        "tooltip": [
          { "field": "State", "type": "nominal" },
          { "field": "year_num", "type": "quantitative", "title": "Year", "format": "d" },
          { "field": "rain_mm", "type": "quantitative", "title": "Average daily rainfall (mm)", "format": ".2f" }
        ]
      }
    },

    {
      "transform": [
        { "window": [{ "op": "rank", "as": "r" }], "sort": [{ "field": "rain_mm", "order": "descending" }] },
        { "filter": "datum.r == 1" },
        {
          "calculate": "'Highest Average Rainfall for this state is recorded in year: ' + format(datum.year_num,'d') + ' (' + format(datum.rain_mm,'.2f') + ' mm)'",
          "as": "max_label"
        }
      ],
      "mark": {
        "type": "text",
        "align": "right",
        "baseline": "top",
        "fontSize": 15,
        "fontWeight": "bold",
        "color": "#111111"
      },
      "encoding": {
        "x": { "value": 710 },
        "y": { "value": 14 },
        "text": { "field": "max_label" }
      }
    },

    {
      "transform": [
        { "window": [{ "op": "rank", "as": "r" }], "sort": [{ "field": "rain_mm", "order": "ascending" }] },
        { "filter": "datum.r == 1" },
        {
          "calculate": "'Lowest Average Rainfall for this state is recorded in year: ' + format(datum.year_num,'d') + ' (' + format(datum.rain_mm,'.2f') + ' mm)'",
          "as": "min_label"
        }
      ],
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "bottom",
        "fontSize": 15,
        "fontWeight": "bold",
        "color": "#111111"
      },
      "encoding": {
        "x": { "value": 10 },
        "y": { "value": 410 },
        "text": { "field": "min_label" }
      }
    }
  ],

  "config": { "view": { "stroke": null }, "axis": { "grid": true } }
}