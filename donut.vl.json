{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#ffffff",
  "config": {
    "view": { "stroke": null },
    "axis": { "grid": false, "domain": false, "ticks": false, "labels": false },
    "legend": { "labelColor": "#334155", "titleColor": "#334155", "labelFontSize": 13, "titleFontSize": 14, "symbolSize": 180, "padding": 6, "labelFont": "Inter", "titleFont": "Inter" },
    "font": "Inter",
    "title": { "font": "Inter" },
    "axisX": { "labelFont": "Inter", "titleFont": "Inter" },
    "axisY": { "labelFont": "Inter", "titleFont": "Inter" },
    "header": { "labelFont": "Inter", "titleFont": "Inter" },
    "text": { "font": "Inter" }
  },
  "params": [
    {
      "name": "YearPick",
      "value": 2020,
      "bind": { "input": "select", "name": "Year: ", "options": [2014, 2015, 2016, 2017, 2018, 2019, 2020] }
    }
  ],
  "width": 500,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/Nashmia101/project3179/main/Humid_malaysia_CLEAN_2014_2020_IMPUTED.csv",
    "format": { "type": "csv" }
  },
  "transform": [
    { "filter": "toNumber(datum.Year) == YearPick" },
    { "calculate": "toNumber(datum['Mean relative humidity in Percentage'])", "as": "rh" },
    { "filter": "isValid(datum.rh)" },
    { "calculate": "datum.State + '|' + datum['Selected meteorological station ']", "as": "station_key" },
    { "calculate": "datum.rh >= 80 ? '≥80%' : (datum.rh >= 75 ? '75–80%' : (datum.rh >= 70 ? '70–75%' : '<70%'))", "as": "RH_Band" },
    {
      "aggregate": [
        { "op": "distinct", "field": "station_key", "as": "n" }
      ],
      "groupby": ["RH_Band"]
    },
    { "joinaggregate": [ { "op": "sum", "field": "n", "as": "total" } ] },
    { "calculate": "datum.n / datum.total", "as": "pct" }
  ],
  "layer": [
    {
      "mark": { "type": "arc", "innerRadius": 120, "outerRadius": 220, "stroke": "#ffffff", "strokeWidth": 2 },
      "encoding": {
        "theta": { "field": "n", "type": "quantitative" },
        "color": {
          "field": "RH_Band",
          "type": "nominal",
          "title": "Humidity band",
          "sort": ["<70%", "70–75%", "75–80%", "≥80%"],
          "scale": {
            "domain": ["70–75%", "75–80%", "≥80%"],
            "range": ["#9467bd", "#1f77b4", "#2ca02c"]
          },
          "legend": { "orient": "none", "legendX": 620, "legendY": 24, "labelFontSize": 16, "titleFontSize": 18 }
        },
        "tooltip": [
          { "field": "RH_Band", "title": "Humidity Band" },
          { "field": "n", "title": "Number of Stations", "format": "," },
          { "field": "pct", "title": "Percentage of All Stations", "format": ".1%" }
        ]
      }
    },
    {
      "transform": [
        { "window": [ { "op": "rank", "as": "r" } ], "sort": [ { "field": "pct", "order": "descending" } ] },
        { "filter": "datum.r == 1" },
        { "calculate": "format(datum.pct, '.0%') + ' of stations in ' + YearPick", "as": "line1" },
        { "calculate": "'had humidity within the ' + datum.RH_Band + ' band'", "as": "line2" },
        { "calculate": "datum.line1 + '\\n' + datum.line2", "as": "anno" }
      ],
      "mark": {
        "type": "text",
        "x": 420,
        "y": 240,
        "align": "center",
        "baseline": "middle",
        "fontSize": 13,
        "fontWeight": "bold",
        "fill": "#334155",
        "lineBreak": "\n",
        "lineHeight": 16
      },
      "encoding": { "text": { "field": "anno" } }
    }
  ]
}
