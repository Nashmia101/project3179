{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "State Temperature — Lollipop (vertical, select year & metric)",
  "width": 980,
  "height": 540,
  "config": { "view": { "stroke": null }, "axis": { "grid": true } },

  "data": { "url": "https://raw.githubusercontent.com/Nashmia101/project3179/main/state_temp_2014_2020.csv" },

  "params": [
    {"name":"year_selection","value":2020,
     "bind":{"input":"select","options":[2014,2015,2016,2017,2018,2019,2020],
             "labels":["2014","2015","2016","2017","2018","2019","2020"],
             "name":"Select Year: "}},
    {"name":"metric_selection","value":"Max Temp",
     "bind":{"input":"select","options":["Min Temp","Max Temp"],"name":"Metric: "}},
    {"name":"show_labels","value":true,"bind":{"input":"checkbox","name":"Show values "}}
  ],

  "transform": [
    {"filter":"toNumber(datum.Year)==toNumber(year_selection)"},
    {"filter":"datum.State!='Sabah' && datum.State!='Sarawak' && datum.State!='Labuan'"},
    {"calculate":"toNumber(datum.MinTemp_C)","as":"min_c"},
    {"calculate":"toNumber(datum.MaxTemp_C)","as":"max_c"},
    {"calculate":"metric_selection == 'Min Temp' ? datum.min_c : datum.max_c","as":"value"},
    {"calculate":"metric_selection == 'Min Temp' ? 20 : 30","as":"baseline"}
  ],

  "layer": [
    {
      "mark": { "type": "rule", "strokeWidth": 6, "opacity": 0.75 },
      "encoding": {
        "x": {
          "field": "State", "type": "ordinal",
          "sort": {"field": "value", "order": "descending"},
          "axis": { "title": null, "labelAngle": -35 }
        },
        "y": {
          "field": "baseline", "type": "quantitative",
          "scale": { "domain": { "expr": "metric_selection == 'Min Temp' ? [20, 26] : [30, 33.5]" }, "nice": false }
        },
        "y2": { "field": "value" },
        "color": { "field": "State", "type": "nominal", "legend": null, "scale": { "scheme": "tableau20" } }
      }
    },

    {
      "mark": { "type": "circle", "filled": true, "size": 700, "stroke": null },
      "encoding": {
        "x": {
          "field": "State", "type": "ordinal",
          "sort": {"field": "value", "order": "descending"},
          "axis": { "title": null, "labelAngle": -35 }
        },
        "y": {
          "field": "value", "type": "quantitative",
          "scale": { "domain": { "expr": "metric_selection == 'Min Temp' ? [20, 26] : [30, 33.5]" }, "nice": false },
          "axis": {
            "title": "Temperature (°C)",
            "values": { "expr": "sequence(metric_selection=='Min Temp'?20:30,(metric_selection=='Min Temp'?26:33.5)+0.0001,1)" },
            "tickMinStep": 1
          }
        },
        "color": { "field": "State", "type": "nominal", "legend": null, "scale": { "scheme": "tableau20" } },
        "tooltip": [{"field":"State"},{"field":"Year","title":"Year"},{"field":"value","title":"Temperature (°C)","format":".2f"}]
      }
    },

    {
      "transform": [{"filter":"show_labels"}],
      "mark": { "type": "text", "align": "center", "dy": -8, "fontSize": 11, "fontWeight": "bold", "fill": "#111827" },
      "encoding": {
        "x": { "field": "State", "type": "ordinal", "sort": {"field":"value","order":"descending"} },
        "y": {
          "field": "value", "type": "quantitative",
          "scale": { "domain": { "expr": "metric_selection == 'Min Temp' ? [20, 26] : [30, 33.5]" }, "nice": false }
        },
        "text": { "field": "value", "type": "quantitative", "format": ".2f" }
      }
    }
  ]
}
